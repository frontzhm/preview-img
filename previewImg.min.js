const defaultOptions={isListenWheel:false,startZoom:1,isClickShadeClose:true,colorMask:"rgba(0,0,0,.7)",hasCloseBox:true,hasActionBox:true,hasAnimateWhenIsImgEl:false,afterCloseCallback:null,afterScaleCallback:null};function previewImg(urlOrImgEl,options={}){options={...defaultOptions,...options};let scale=1.0;let deg=0;let layerImage=null;let layerAction=null;let hint=null;let imgMiddle=null;let imgMiddleWidth;let imgMiddleHeight;popImg(urlOrImgEl,options.hasAnimateWhenIsImgEl);function popImg(urlOrImgEl,hasAnimateWhenIsImgEl=false){let box=document.getElementById("yyz-img-zoom");box&&box.remove();layerImage=createLayerImage(options.isClickShadeClose);document.body.appendChild(layerImage);setTimeout(function(){layerImage.style.background=options.colorMask},1);hint=createHint();layerImage.appendChild(hint);imgMiddle=createImgMiddle(urlOrImgEl,hasAnimateWhenIsImgEl,options);layerImage.appendChild(imgMiddle);layerAction=createLayerAction(options);setTimeout(()=>document.body.appendChild(layerAction),250);options.isListenWheel=true}function createLayerImage(isClickShadeClose=true){const layerImageEl=document.createElement("div");layerImageEl.id="yyz-img-zoom";layerImageEl.style.cssText=`width:100%;height:100vh;position:fixed;left:0;top:0;background:rgba(0,0,0,0);transition:background 0.5s;z-index:1001;display:flex;justify-content:center;align-items:center;`;isClickShadeClose&&layerImageEl.addEventListener("click",close);const{handleTouchStart,handleTouchMove,handleTouchEnd}=handleTouch();layerImageEl.addEventListener("touchstart",(event)=>handleTouchStart(event));layerImageEl.addEventListener("touchmove",(event)=>handleTouchMove(event));layerImageEl.addEventListener("touchend",(event)=>handleTouchEnd(event));return layerImageEl}function handleTouch(){let startX;let startY;let startDst=1;let startDeg=0;let startTop=0;let startLeft=0;let startHeigh;let startWidth;let startCentreY;let startCentreX;let startZhong;function handleTouchStart(event){const img=imgMiddle;if(event.touches.length>=2){startDeg=getDeg(event.touches[0],event.touches[1])-deg;startDst=getDst(event.touches[0],event.touches[1])/scale;startTop=img.offsetTop;startLeft=img.offsetLeft;startZhong=getZhong(event.touches[0],event.touches[1]);startHeigh=scale*imgMiddleHeight;startWidth=scale*imgMiddleWidth;startCentreY=(startZhong.y-startTop)/startHeigh;startCentreX=(startZhong.x-startLeft)/startWidth}else if(event.touches.length==1){startX=event.touches[0].clientX;startY=event.touches[0].clientY;startTop=img.offsetTop;startLeft=img.offsetLeft}event.preventDefault()}function handleTouchMove(event){const img=imgMiddle;let canRotateTwoFinger=false;if(event.touches.length>=2){let currentDst=getDst(event.touches[0],event.touches[1]);let currentZhong=getZhong(event.touches[0],event.touches[1]);scale=Math.max(currentDst/startDst,0.1);options.sizeCallback&&options.sizeCallback(scale);hintPopup(Math.round(scale*100)+"%");let newW=scale*imgMiddleWidth;let newH=scale*imgMiddleHeight;img.style.width=newW+"px";img.style.height=newH+"px";let ztop=currentZhong.y-startZhong.y;let zleft=currentZhong.x-startZhong.x;img.style.top=startTop-(newH-startHeigh)*startCentreY+ztop+"px";img.style.left=startLeft-(newW-startWidth)*startCentreX+zleft+"px";if(canRotateTwoFinger){let currentDeg=getDeg(event.touches[0],event.touches[1]);deg=currentDeg-startDeg;img.style.transform="rotate("+deg+"deg)"}}else if(event.touches.length==1){let X=event.touches[0].clientX-startX;let Y=event.touches[0].clientY-startY;img.style.left=X+startLeft+"px";img.style.top=Y+startTop+"px"}}function handleTouchEnd(event){const img=imgMiddle;if(event.touches.length==1){startX=event.touches[0].clientX;startY=event.touches[0].clientY;startTop=img.offsetTop;startLeft=img.offsetLeft}}return{handleTouchStart,handleTouchMove,handleTouchEnd}}function createHint(){const hintEl=document.createElement("div");hintEl.style.cssText=`border-radius:60px;background-color:#000;color:#fff;padding:2px 5px;z-index:1003;display:none;user-select:none;`;hintEl.addEventListener("click",(e)=>e.stopPropagation());return hintEl}function createImgMiddle(urlOrImgEl,hasAnimateWhenIsImgEl,{startZoom=1}){const imgEl=document.createElement("img");let cssText=`width:10px;height:10px;top:50%;left:50%;`;if(typeof urlOrImgEl==="object"){const boundingClientRect=urlOrImgEl.getBoundingClientRect();const followCss=`width:${boundingClientRect.width}px;height:${boundingClientRect.height}px;top:${boundingClientRect.top}px;left:${boundingClientRect.left}px;`;cssText=hasAnimateWhenIsImgEl?followCss:cssText}imgEl.style.cssText=cssText+`z-index:1002;position:absolute;cursor:move;-webkit-tap-highlight-color:transparent;user-select:none;`;imgEl.id="yyz-img";const url=typeof urlOrImgEl=="string"?urlOrImgEl:urlOrImgEl.src;imgEl.src=url;imgEl.draggable=false;imgEl.addEventListener("click",(e)=>e.stopPropagation());imgEl.onload=function(){const isWidthLonger=imgEl.offsetWidth/imgEl.offsetHeight>layerImage.offsetWidth/layerImage.offsetHeight;const widthLongerCss=`transition:all 0.5s;height:auto;width:${startZoom*100}%;left:${(layerImage.offsetWidth-layerImage.offsetWidth*startZoom)/2}px;top:${(layerImage.offsetHeight-startZoom*layerImage.offsetWidth*(imgEl.offsetHeight/imgEl.offsetWidth))/2}px;`;const heightLongerCss=`transition:all 0.5s;width:auto;height:${startZoom*100}%;top:${(layerImage.offsetHeight-layerImage.offsetHeight*startZoom)/2}px;left:${(layerImage.offsetWidth-layerImage.offsetHeight*startZoom*(imgEl.offsetWidth/imgEl.offsetHeight))/2}px;`;imgEl.style.cssText+=isWidthLonger?widthLongerCss:heightLongerCss;setTimeout(function(){imgEl.style.transition="";imgMiddleWidth=imgEl.offsetWidth;imgMiddleHeight=imgEl.offsetHeight},500)};imgEl.onmousedown=(event)=>{event.stopPropagation();let disX=event.clientX-imgEl.offsetLeft;let disY=event.clientY-imgEl.offsetTop;document.onmousemove=(event)=>{imgEl.style.left=event.clientX-disX+"px";imgEl.style.top=event.clientY-disY+"px"}};imgEl.onmouseup=()=>{document.onmousemove=null};return imgEl}function createLayerAction(options){const{hasCloseBox,hasActionBox}=options;const layerActionEl=document.createElement("div");layerActionEl.style.cssText=`z-index:1005;-webkit-tap-highlight-color:transparent;position:fixed;top:0;left:0;height:100vh;width:100%;pointer-events:none;`;if(hasCloseBox){const closeBox=`<div class="close-box"onclick="previewImg.close()"style="pointer-events: auto;cursor:pointer; position: absolute;right: 0;top: 0;border-radius: 0 0 0 60px; width: 50px;height: 50px;background-color:rgba(0, 0, 0, .3);"><div class="close-icon-div"style="width: 14px;height: 14px;padding: 3px; position: absolute;right: 10px;top: 10px;"><svg t="1616924133328"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="2052"width="14"height="14"><path d="M1023.997 114.97 911.408 2.388 516.149 397.629 118.5 0 5.91 112.585l397.649 397.629L7.107 906.648l112.587 112.59 396.454-396.439 395.259 395.249 112.59-112.59L628.738 510.214 1023.997 114.97z"p-id="2053"fill="#ffffff"></path></svg></div></div>`;layerActionEl.innerHTML+=closeBox}if(hasActionBox){const actionBox=`<div style="pointer-events: auto;position: absolute;bottom: 20px;left:0;width: 100%;"><div style="padding: 0 0px; margin: 0 auto;height: 40px;width: 160px;background-color: rgba(0, 0, 0, .3);border-radius: 20px;"><div onclick="previewImg.upScale()"onMouseOver="this.style.backgroundColor='rgba(0, 0, 0, .6)'"onMouseOut="this.style.backgroundColor=''"style="border-radius: 20px;width: 20px; height: 20px; padding: 10px;float: left;cursor:pointer;"><svg t="1616925103431"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="10151"width="20"height="20"><path d="M836 476H548V188c0-19.8-16.2-36-36-36s-36 16.2-36 36v288H188c-19.8 0-36 16.2-36 36s16.2 36 36 36h288v288c0 19.8 16.2 36 36 36s36-16.2 36-36V548h288c19.8 0 36-16.2 36-36s-16.2-36-36-36z"p-id="10152"fill="#ffffff"></path></svg></div><div onclick="previewImg.downScale()"onMouseOver="this.style.backgroundColor='rgba(0, 0, 0, .6)'"onMouseOut="this.style.backgroundColor=''"style="border-radius: 20px;width: 20px; height: 20px; padding: 10px;float: left;cursor:pointer;"><svg t="1616925668114"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="10948"width="20"height="20"><path d="M725.33 480H298.66c-17.67 0-32 14.33-32 32s14.33 32 32 32h426.67c17.67 0 32-14.33 32-32s-14.32-32-32-32z"p-id="10949"fill="#ffffff"></path></svg></div><div onclick="previewImg.rotateRight()"onMouseOver="this.style.backgroundColor='rgba(0, 0, 0, .6)'"onMouseOut="this.style.backgroundColor=''"style="border-radius: 20px;width: 20px; height: 20px; padding: 10px;float: left;cursor:pointer;"><svg t="1616925730136"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="1951"width="20"height="20"><path d="M503.466667 285.866667L405.333333 226.133333c-8.533333-8.533333-12.8-21.333333-8.533333-29.866666 8.533333-8.533333 21.333333-12.8 29.866667-8.533334l145.066666 89.6c8.533333 4.266667 12.8 17.066667 8.533334 29.866667l-89.6 145.066667c-4.266667 8.533333-17.066667 12.8-29.866667 8.533333-8.533333-4.266667-12.8-17.066667-8.533333-29.866667l64-102.4c-123.733333 4.266667-226.133333 106.666667-226.133334 234.666667s106.666667 234.666667 234.666667 234.666667c85.333333 0 162.133333-46.933333 204.8-119.466667 4.266667-8.533333 17.066667-12.8 29.866667-8.533333 8.533333 4.266667 12.8 17.066667 8.533333 29.866666-51.2 85.333333-140.8 140.8-238.933333 140.8-153.6 0-277.333333-123.733333-277.333334-277.333333 0-145.066667 110.933333-264.533333 251.733334-277.333333z"p-id="1952"fill="#ffffff"></path></svg></div><div onclick="previewImg.rotateLeft()"onMouseOver="this.style.backgroundColor='rgba(0, 0, 0, .6)'"onMouseOut="this.style.backgroundColor=''"style="border-radius: 20px;width: 20px; height: 20px; padding: 10px;float: left;cursor:pointer;"><svg t="1616925759280"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="2144"width="20"height="20"><path d="M520.533333 285.866667c140.8 12.8 251.733333 132.266667 251.733334 277.333333 0 153.6-123.733333 277.333333-277.333334 277.333333-98.133333 0-192-55.466667-238.933333-140.8-4.266667-8.533333-4.266667-21.333333 8.533333-29.866666 8.533333-4.266667 21.333333-4.266667 29.866667 8.533333 42.666667 72.533333 119.466667 119.466667 204.8 119.466667 128 0 234.666667-106.666667 234.666667-234.666667s-98.133333-230.4-226.133334-234.666667l64 102.4c4.266667 8.533333 4.266667 21.333333-8.533333 29.866667-8.533333 4.266667-21.333333 4.266667-29.866667-8.533333l-89.6-145.066667c-4.266667-8.533333-4.266667-21.333333 8.533334-29.866667L597.333333 187.733333c8.533333-4.266667 21.333333-4.266667 29.866667 8.533334 4.266667 8.533333 4.266667 21.333333-8.533333 29.866666l-98.133334 59.733334z"p-id="2145"fill="#ffffff"></path></svg></div></div></div>`;layerActionEl.innerHTML+=actionBox}return layerActionEl}function getDst(touch1,touch2){let x=touch2.clientX-touch1.clientX;let y=touch2.clientY-touch1.clientY;let z=Math.sqrt(x*x+y*y);return z}function getDeg(touch1,touch2){let x=touch2.clientX-touch1.clientX;let y=touch2.clientY-touch1.clientY;let angle=Math.atan2(y,x);let deg=(angle/Math.PI)*180;return deg}function getZhong(touch1,touch2){let dd={};dd.x=Math.abs(touch2.clientX+touch1.clientX)/2;dd.y=Math.abs(touch2.clientY+touch1.clientY)/2;return dd}let scrollFunc=function(e){if(!options.isListenWheel){return}e=e||window.event;e.preventDefault&&e.preventDefault();let value;if(e.wheelDelta){value=e.wheelDelta}else if(e.detail){value=e.detail}console.log(value);if(value>0){scale+=0.15}else{scale-=0.15}if(scale<0.1){scale=0.1}if(sizeCallback!=null){sizeCallback(scale)}hintPopup(Math.round(scale*100)+"%");let newW=scale*imgMiddleWidth;let newH=scale*imgMiddleHeight;const img=imgMiddle;let oldH=img.offsetHeight;let oldW=img.offsetWidth;let imgNtop=(e.clientY-img.offsetTop)/img.offsetHeight;let imgNleft=(e.clientX-img.offsetLeft)/img.offsetWidth;img.style.width=newW+"px";img.style.height=newH+"px";img.style.top=img.offsetTop-(img.offsetHeight-oldH)*imgNtop+"px";img.style.left=img.offsetLeft-(img.offsetWidth-oldW)*imgNleft+"px"};if(document.addEventListener){document.addEventListener("DOMMouseScroll",scrollFunc,false)}window.addEventListener("mousewheel",scrollFunc,{passive:false});function hintPopup(textToast){let hintTime=300;if(hintTime==0)return;hint.style.display="";hint.innerText=textToast;if(hintTimer){clearTimeout(hintTimer)}hintTimer=setTimeout(function(){hint.style.display="none"},hintTime)}let hintTimer;function upScale(e){if(e&&e.stopPropagation)e.stopPropagation();scale+=0.2;upSize()}function downScale(e){if(e&&e.stopPropagation)e.stopPropagation();scale-=0.2;upSize()}function rotateLeft(e){if(e&&e.stopPropagation)e.stopPropagation();deg-=90;upRotate()}function rotateRight(e){if(e&&e.stopPropagation)e.stopPropagation();deg+=90;upRotate()}function upRotate(){const img=imgMiddle;img.style.transition="transform 0.3s";img.style.transform="rotate("+deg+"deg)";clearTimeout(rotateTimer);rotateTimer=setTimeout(function(){img.style.transition=""},300)}let rotateTimer;function upSize(){if(scale<0.1){scale=0.1}if(sizeCallback!=null){sizeCallback(scale)}hintPopup(Math.round(scale*100)+"%");let newW=scale*imgMiddleWidth;let newH=scale*imgMiddleHeight;const img=imgMiddle;let oldH=img.offsetHeight;let oldW=img.offsetWidth;let imgNtop=(layerImage.offsetHeight/2-img.offsetTop)/img.offsetHeight;let imgNleft=(layerImage.offsetWidth/2-img.offsetLeft)/img.offsetWidth;img.style.transition="all 0.3s";img.style.width=newW+"px";img.style.height=newH+"px";img.style.top=img.offsetTop-(newH-oldH)*imgNtop+"px";img.style.left=img.offsetLeft-(newW-oldW)*imgNleft+"px";clearTimeout(rotateTimer);rotateTimer=setTimeout(function(){img.style.transition=""},300)}let sizeCallback=null;function setSizeCallback(call){sizeCallback=call}function close(){if(layerImage==null){return}options.afterCloseCallback&&options.afterCloseCallback();options.isListenWheel=false;layerAction.parentNode.removeChild(layerAction);(function removeImgLayerAfterAnimate(){layerImage.style.transition="all 0.2s";layerImage.style.opacity=0;setTimeout(()=>layerImage.parentNode.removeChild(layerImage),200)})()}previewImg.close=close;previewImg.upScale=upScale;previewImg.downScale=downScale;previewImg.rotateLeft=rotateLeft;previewImg.rotateRight=rotateRight}